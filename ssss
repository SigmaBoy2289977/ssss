local Luna = loadstring(game:HttpGet("https://raw.githubusercontent.com/Nebula-Softworks/Luna-Interface-Suite/refs/heads/master/source.lua", true))()

-- –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –æ–∫–Ω–∞
local Window = Luna:CreateWindow({
    Name = "üåô MM2 Ultimate Coin Farmer | Gojo Hub",
    Subtitle = "v8.5 | Smooth Flight | Auto-Respawn",
    LogoID = nil,
    LoadingEnabled = true,
    LoadingTitle = "Loading Advanced System...",
    LoadingSubtitle = "by Gojo",
    
    ConfigSettings = {
        RootFolder = nil,
        ConfigFolder = "GojoHub"
    },

    KeySystem = false
})

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local Settings = {
    Enabled = false,
    FlightSpeed = 25,
    NoClip = true,
    SearchRadius = 150,
    CollectDistance = 3.5,  -- –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –ø–æ–ª–µ—Ç–∞ –ø–æ–¥ –º–æ–Ω–µ—Ç–æ–π
    CoinCount = 0,
    MaxCoins = 40,
    AutoRespawn = true,     -- –í–µ—Ä–Ω—É–ª–∏ –∞–≤—Ç–æ-—Ä–µ—Å–ø–∞–≤–Ω
    CurrentTarget = nil,
    Cooldown = false,
    Farming = false,
    PlayerDied = false,
    Velocity = Vector3.new(0, 0, 0) -- –î–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ–ª–µ—Ç–∞
}

-- –°–æ–∑–¥–∞–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏
local MainTab = Window:CreateTab({
    Name = "üåë Main",
    Icon = "star",
    ImageSource = "Material",
    ShowTitle = true
})

-- –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
local StatusLabel = MainTab:CreateLabel({
    Text = "üåë Status: INACTIVE | Coins: 0/40 | Speed: 25",
    Bold = false,
    Underline = false,
    Center = false
})

-- –§—É–Ω–∫—Ü–∏–∏
local function IsRoundActive()
    local player = game.Players.LocalPlayer
    local mainGui = player and player.PlayerGui:FindFirstChild("MainGUI")
    return mainGui and mainGui:FindFirstChild("Game") and mainGui.Game.Visible
end

local function ResetCoinCount()
    Settings.CoinCount = 0
    StatusLabel:Set(string.format("üåë Status: %s | Coins: %d/%d | Speed: %d", 
        Settings.Enabled and "ACTIVE" or "INACTIVE", 
        Settings.CoinCount, 
        Settings.MaxCoins, 
        Settings.FlightSpeed))
end

local function TeleportToLobby()
    local lobby = workspace:FindFirstChild("Lobby", true)
    if lobby then
        local part = lobby:FindFirstChildWhichIsA("BasePart", true) or lobby:FindFirstChildWhichIsA("BasePart")
        if part then
            local char = game.Players.LocalPlayer.Character
            if char and char.PrimaryPart then
                char:SetPrimaryPartCFrame(part.CFrame + Vector3.new(0, 3, 0))
                return true
            end
        end
    end
    return false
end

local function RespawnPlayer()
    local player = game.Players.LocalPlayer
    if not player.Character then return end
    
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Dead)
        task.wait(0.5)
        if player.Character then
            player.Character:BreakJoints()
        end
    end
    
    repeat task.wait() until player.Character and player.Character:FindFirstChildOfClass("Humanoid") and player.Character.Humanoid.Health > 0
end

local function RestartFarm()
    if not Settings.Enabled then return end
    
    Settings.Farming = false
    task.wait(0.5)
    
    Settings.CurrentTarget = nil
    Settings.Farming = true
    StartFarming()
end

local function AddCoin()
    if Settings.Cooldown then return false end
    
    Settings.Cooldown = true
    Settings.CoinCount = Settings.CoinCount + 1
    StatusLabel:Set(string.format("üåï Status: ACTIVE | Coins: %d/%d | Speed: %d", 
        Settings.CoinCount, Settings.MaxCoins, Settings.FlightSpeed))
    
    task.delay(0.5, function()
        Settings.Cooldown = false
    end)
    
    return true
end

local function IsValidCoin(coin)
    return coin and coin.Parent and coin:IsA("BasePart") and coin:FindFirstChildWhichIsA("TouchTransmitter")
end

local function FindNearestCoin()
    local character = game.Players.LocalPlayer.Character
    if not character or not character.PrimaryPart then return nil end

    local closestCoin, minDist = nil, math.huge
    local charPos = character.PrimaryPart.Position

    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj:FindFirstChildWhichIsA("TouchTransmitter") then
            if obj.Name:lower():find("coin") or obj.Name:lower():find("orb") then
                local dist = (obj.Position - charPos).Magnitude
                if dist < minDist and dist <= Settings.SearchRadius then
                    closestCoin = obj
                    minDist = dist
                end
            end
        end
    end

    return closestCoin
end

local function FlyToCoin(target)
    local character = game.Players.LocalPlayer.Character
    if not character or not character.PrimaryPart then return false end

    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.P = 1500
    bodyVelocity.Parent = character.PrimaryPart

    local startTime = tick()
    local success = false
    Settings.CurrentTarget = target
    Settings.Velocity = Vector3.new(0, 0, 0) -- –°–±—Ä–æ—Å —Å–∫–æ—Ä–æ—Å—Ç–∏
    
    while Settings.Enabled and Settings.Farming and tick() - startTime < 30 do
        if not IsRoundActive() then
            RestartFarm()
            break
        end
        
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if not humanoid or humanoid.Health <= 0 then
            break
        end
        
        if not IsValidCoin(target) then
            break
        end
        
        -- –ü–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
        local targetPos = target.Position
        -- –õ–µ—Ç–∏–º –ø–æ–¥ –º–æ–Ω–µ—Ç–æ–π (–Ω–∞ 5 –µ–¥–∏–Ω–∏—Ü –Ω–∏–∂–µ)
        local safePos = Vector3.new(targetPos.X, targetPos.Y - 5, targetPos.Z)
        
        local direction = (safePos - character.PrimaryPart.Position)
        local distance = direction.Magnitude
        direction = direction.Unit
        
        -- –ü–ª–∞–≤–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ
        local targetSpeed = math.min(Settings.FlightSpeed, distance * 2)
        Settings.Velocity = Settings.Velocity:Lerp(direction * targetSpeed, 0.2)
        bodyVelocity.Velocity = Settings.Velocity
        
        if distance <= Settings.CollectDistance then
            firetouchinterest(character.PrimaryPart, target, 0)
            task.wait(0.05)
            firetouchinterest(character.PrimaryPart, target, 1)
            
            if not IsValidCoin(target) then
                if AddCoin() then
                    if Settings.CoinCount >= Settings.MaxCoins then
                        if Settings.AutoRespawn then
                            RespawnPlayer()
                        else
                            TeleportToLobby()
                        end
                        ResetCoinCount()
                    end
                end
                success = true
            end
            break
        end
        
        task.wait()
    end

    bodyVelocity:Destroy()
    return success
end

function StartFarming()
    if Settings.Farming or not Settings.Enabled then return end
    Settings.Farming = true
    
    while Settings.Enabled and Settings.Farming do
        if not IsRoundActive() then
            task.wait(2)
            RestartFarm()
            break
        end
        
        local character = game.Players.LocalPlayer.Character
        local humanoid = character and character:FindFirstChildOfClass("Humanoid")
        if not humanoid or humanoid.Health <= 0 then
            task.wait(2)
            RestartFarm()
            break
        end
        
        if Settings.CoinCount >= Settings.MaxCoins then
            if Settings.AutoRespawn then
                RespawnPlayer()
            else
                TeleportToLobby()
            end
            ResetCoinCount()
            task.wait(2)
            RestartFarm()
            break
        end
        
        local target = FindNearestCoin()
        if target then
            if IsValidCoin(target) then
                FlyToCoin(target)
            else
                task.wait(0.1)
            end
        else
            task.wait(0.5)
        end
    end
    
    Settings.Farming = false
end

-- –≠–ª–µ–º–µ–Ω—Ç—ã UI
MainTab:CreateToggle({
    Name = "üåï Enable Auto Farmer",
    CurrentValue = false,
    Callback = function(Value)
        Settings.Enabled = Value
        if Value then
            StatusLabel:Set(string.format("üåï Status: ACTIVE | Coins: %d/%d | Speed: %d", 
                Settings.CoinCount, Settings.MaxCoins, Settings.FlightSpeed))
            StartFarming()
        else
            StatusLabel:Set("üåë Status: INACTIVE | Coins: 0/"..Settings.MaxCoins)
            Settings.Farming = false
            ResetCoinCount()
            -- –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—Å—è –≤ –ª–æ–±–±–∏
            TeleportToLobby()
        end
    end
})

MainTab:CreateToggle({
    Name = "üîÑ Auto Respawn",
    CurrentValue = true,
    Callback = function(Value)
        Settings.AutoRespawn = Value
    end
})

MainTab:CreateSlider({
    Name = "üéØ Coin Limit",
    Range = {10, 50},
    Increment = 1,
    Suffix = " coins",
    CurrentValue = 40,
    Callback = function(Value)
        Settings.MaxCoins = Value
        StatusLabel:Set(string.format("üåë Status: %s | Coins: %d/%d | Speed: %d", 
            Settings.Enabled and "ACTIVE" or "INACTIVE", 
            Settings.CoinCount, 
            Settings.MaxCoins, 
            Settings.FlightSpeed))
    end
})

MainTab:CreateSlider({
    Name = "üöÄ Flight Speed",
    Range = {10, 50},
    Increment = 1,
    Suffix = " studs",
    CurrentValue = 25,
    Callback = function(Value)
        Settings.FlightSpeed = Value
        StatusLabel:Set(string.format("üåë Status: %s | Coins: %d/%d | Speed: %d", 
            Settings.Enabled and "ACTIVE" or "INACTIVE", 
            Settings.CoinCount, 
            Settings.MaxCoins, 
            Settings.FlightSpeed))
    end
})

-- –ö–Ω–æ–ø–∫–∞ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ –≤ –ª–æ–±–±–∏
MainTab:CreateButton({
    Name = "üö™ Teleport To Lobby",
    Callback = function()
        TeleportToLobby()
    end
})

-- NoClip
game:GetService("RunService").Stepped:Connect(function()
    if Settings.Enabled and Settings.NoClip then
        pcall(function()
            local character = game.Players.LocalPlayer.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    end
end)

-- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
game.Players.LocalPlayer.CharacterAdded:Connect(function()
    if Settings.Enabled then
        ResetCoinCount()
        task.wait(1)
        RestartFarm()
    end
end)

workspace.ChildAdded:Connect(function(child)
    if child.Name == "Lobby" and Settings.Enabled then
        ResetCoinCount()
    end
end)

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—É–Ω–¥–∞
game:GetService("RunService").Heartbeat:Connect(function()
    if not Settings.Enabled then return end
    
    if not IsRoundActive() then
        ResetCoinCount()
        Settings.Farming = false
        return
    end
    
    local character = game.Players.LocalPlayer.Character
    if not character then return end
    
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then
        ResetCoinCount()
        Settings.Farming = false
        return
    end
    
    if humanoid.Health <= 0 then
        ResetCoinCount()
        Settings.Farming = false
        return
    end
    
    if Settings.CoinCount >= Settings.MaxCoins and not Settings.Farming then
        if Settings.AutoRespawn then
            RespawnPlayer()
        else
            TeleportToLobby()
        end
        ResetCoinCount()
        task.wait(2)
        RestartFarm()
        return
    end
    
    if not Settings.Farming then
        StartFarming()
    end
end)
